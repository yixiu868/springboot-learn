# CSRF

Cross-site request forgery 跨站请求伪造

[CSRF详解](https://www.cnblogs.com/sablier/p/11099909.html)

## CSRF攻击原理及过程

* 1）用户A打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；
* 2）在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功；
* 3）用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；
* 4）网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；
* 5）浏览器再接收到这些攻击性代码后，根据网站的请求，在用户不知情的情况下携带Cookie信息，向网站A发送请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以及C的权限处理该请求，导致网站B的恶意代码被执行。

## 如何防御CSRF

* 1）提交验证码

  在表单中添加一个随机的数字或字母验证码，通过强制用户和应用进行交互，可以有效遏制CSRF攻击。

* 2）Referer Check

  检查是否非正常页面过来的请求。

* 3）token验证

  * 在HTTP请求中以参数的形式添加一个随机产生的token，并在服务端建立一个拦截器验证这个token，假设请求中没有token或者token不对，可能是CSRF攻击，拒绝请求。
  * token必须要足够随机
  * 敏感的操作应该使用POST，避免token泄漏

* 4）在HTTP头中自己定义属性并验证

  这样的方法也是使用token并进行验证。

## 浏览器同源策略

当协议，域名，端口不相同时，即为不同源。

所谓同源是指协议、域名、端口相同，当一个浏览器的两个tab也中分别打开百度和谷歌的页面，浏览器百度tab页执行脚本的时候会检查这个脚本是属于那个页面的，即检查是否同源，只有和百度同源的脚本才会被执行。如果非同源，那么在请求数据时，浏览器会在控制台中报一个异常，提示拒绝访问。

http://www.a.com/a

https://www.a.com/a 不同源，协议不同

http://www.b.com/a 不同源，域名不同

http://www.a.com:8080/a 不同源，端口不同

http://www.a.com/b 同源

跨域问题，就是`请求路径的url不同源`

